<div class="p-4">
    <h3 class="text-lg font-bold text-gray-800 mb-4">Department Summary Report</h3>
    
    <p class="text-sm text-gray-600 mb-4">Total Departments: <strong>{{ total_departments }}</strong></p>
    
    {% if departments %}
    <!-- Charts -->
    <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="h-64">
            <p class="text-sm font-medium text-gray-700 mb-2">Employees by Department</p>
            <canvas id="deptCountChart"></canvas>
        </div>
        <div class="h-64">
            <p class="text-sm font-medium text-gray-700 mb-2">Average Salary by Department</p>
            <canvas id="deptSalaryChart"></canvas>
        </div>
    </div>
    
    <!-- Table -->
    <table class="w-full">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-4 py-2 text-left text-sm font-semibold">Department</th>
                <th class="px-4 py-2 text-right text-sm font-semibold">Employees</th>
                <th class="px-4 py-2 text-right text-sm font-semibold">Avg Salary</th>
                <th class="px-4 py-2 text-right text-sm font-semibold">Total Payroll</th>
            </tr>
        </thead>
        <tbody>
            {% for dept in departments %}
            <tr class="border-b">
                <td class="px-4 py-2 text-sm font-medium">{{ dept.name }}</td>
                <td class="px-4 py-2 text-sm text-right">{{ dept.employee_count }}</td>
                <td class="px-4 py-2 text-sm text-right">
                    {% if dept.avg_salary %}${{ dept.avg_salary|floatformat:0 }}{% else %}—{% endif %}
                </td>
                <td class="px-4 py-2 text-sm text-right">
                    {% if dept.total_salary %}${{ dept.total_salary|floatformat:0 }}{% else %}—{% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <script>
        // Wait for DOM to be ready
        (function() {
            const colors = ['#22c55e', '#3b82f6', '#8b5cf6', '#eab308', '#ef4444', '#ec4899', '#14b8a6', '#f97316'];
            
            const deptNames = {{ dept_names|safe }};
            const deptCounts = {{ dept_counts|safe }};
            const deptSalaries = {{ dept_salaries|safe }};
            
            if (document.getElementById('deptCountChart')) {
                new Chart(document.getElementById('deptCountChart'), {
                    type: 'doughnut',
                    data: {
                        labels: deptNames,
                        datasets: [{
                            data: deptCounts,
                            backgroundColor: colors
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'right', 
                                labels: { boxWidth: 12, font: { size: 10 } } 
                            } 
                        }
                    }
                });
            }
            
            if (document.getElementById('deptSalaryChart')) {
                new Chart(document.getElementById('deptSalaryChart'), {
                    type: 'bar',
                    data: {
                        labels: deptNames,
                        datasets: [{
                            label: 'Avg Salary',
                            data: deptSalaries,
                            backgroundColor: '#8b5cf6',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { 
                                    callback: function(v) { 
                                        return '$' + v.toLocaleString(); 
                                    } 
                                }
                            }
                        }
                    }
                });
            }
        })();
    </script>
    {% else %}
    <div class="text-center py-8 text-gray-500">
        <p>No departments found.</p>
    </div>
    {% endif %}
</div>